<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Planner</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; padding: 20px; }
    h1 { text-align: center; }
    .welcome { text-align: center; margin-bottom: 20px; font-size: 18px; }
    .quote { text-align: center; font-style: italic; margin-bottom: 20px; color: #444; }
    .day-container { margin: 20px auto; max-width: 500px; }
    .task-box { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .task-box h2 { margin-top: 0; font-size: 18px; }
    ul { list-style: none; padding: 0; }
    li { display: flex; align-items: center; margin: 5px 0; }
    li.completed span { text-decoration: line-through; color: gray; }
    li span { flex: 1; }
    .readonly input[type="checkbox"] { pointer-events: none; }
    #taskInput { padding: 8px; width: 70%; }
    #addBtn, #shareBtn { padding: 8px 15px; margin-top: 10px; cursor: pointer; border: none; border-radius: 5px; }
    #addBtn { background: #007bff; color: white; }
    #shareBtn { background: #28a745; color: white; margin-left: 5px; }
  </style>
</head>
<body>
  <h1>Daily Planner</h1>
  <div class="welcome" id="welcome"></div>
  <div class="quote" id="quote"></div>
  <div class="day-container" id="planner"></div>

  <script>
    const planner = document.getElementById("planner");
    const today = new Date().toISOString().split("T")[0]; // yyyy-mm-dd
    let data = JSON.parse(localStorage.getItem("plannerData")) || {};
    let username = localStorage.getItem("plannerUser");

    // Motivational quotes
    const quotes = [
      "Believe in yourself and all that you are.",
      "Small progress each day adds up to big results.",
      "Push yourself, because no one else is going to do it for you.",
      "Dream big. Start small. Act now.",
      "Don’t watch the clock; do what it does. Keep going.",
      "Success is the sum of small efforts repeated day in and day out.",
      "Your limitation—it’s only your imagination.",
      "Hard work beats talent when talent doesn’t work hard."
    ];

    // Pick daily quote (based on date to keep stable for the whole day)
    function getDailyQuote() {
      const dayNumber = new Date().getDate();
      return quotes[dayNumber % quotes.length];
    }

    // Ask for user name if not set
    if (!username) {
      username = prompt("Please enter your name:");
      if (!username) username = "User";
      localStorage.setItem("plannerUser", username);
    }
    document.getElementById("welcome").innerText = `Hi ${username}, here’s your planner for today!`;
    document.getElementById("quote").innerText = `"${getDailyQuote()}"`;

    // Carry forward incomplete tasks
    carryForwardTasks();

    function carryForwardTasks() {
      const dates = Object.keys(data).sort();
      if (dates.length > 0) {
        const lastDate = dates[dates.length - 1];
        if (lastDate < today) {
          const incomplete = data[lastDate].tasks.filter(t => !t.done);
          if (!data[today]) data[today] = { tasks: [] };
          data[today].tasks = [...incomplete, ...data[today].tasks];
          saveData();
        }
      }
    }

    function saveData() {
      localStorage.setItem("plannerData", JSON.stringify(data));
    }

    function renderPlanner() {
      planner.innerHTML = "";
      const dates = Object.keys(data).sort().reverse();
      dates.forEach(date => {
        const box = document.createElement("div");
        box.className = "task-box";
        box.innerHTML = `<h2>${date === today ? "Today" : date}</h2>
                         <ul id="list-${date}"></ul>`;

        const ul = box.querySelector("ul");

        data[date].tasks.forEach((task, i) => {
          const li = document.createElement("li");
          li.className = task.done ? "completed" : "";
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = task.done;

          if (date !== today) li.classList.add("readonly");

          checkbox.addEventListener("change", () => {
            if (date === today && !task.done && checkbox.checked) {
              task.done = true;
              li.classList.add("completed");
              checkbox.disabled = true; // ✅ Lock checkbox after checking
              saveData();
            } else {
              checkbox.checked = task.done; // prevent unchecking
            }
          });

          if (task.done) checkbox.disabled = true; // lock already completed

          const span = document.createElement("span");
          span.textContent = task.text;

          li.appendChild(checkbox);
          li.appendChild(span);
          ul.appendChild(li);
        });

        // Add input only for today
        if (date === today) {
          const input = document.createElement("input");
          input.type = "text";
          input.id = "taskInput";
          input.placeholder = "New task...";

          const addBtn = document.createElement("button");
          addBtn.id = "addBtn";
          addBtn.textContent = "Add";

          addBtn.addEventListener("click", () => {
            if (input.value.trim() !== "") {
              data[today].tasks.push({ text: input.value, done: false });
              input.value = "";
              saveData();
              renderPlanner();
            }
          });

          const shareBtn = document.createElement("button");
          shareBtn.id = "shareBtn";
          shareBtn.textContent = "Share Progress";
          shareBtn.addEventListener("click", () => shareProgress(date));

          box.appendChild(input);
          box.appendChild(addBtn);
          box.appendChild(shareBtn);
        }

        planner.appendChild(box);
      });
    }

    function shareProgress(date) {
      const tasks = data[date].tasks.map(t => `${t.done ? "✅" : "❌"} ${t.text}`).join("\n");
      const text = `My progress on ${date}:\n\n${tasks}\n\n~ ${username}`;
      navigator.clipboard.writeText(text).then(() => {
        alert("Progress copied! You can now share it with friends.");
      });
    }

    // Initialize if today's data not present
    if (!data[today]) data[today] = { tasks: [] };

    saveData();
    renderPlanner();
  </script>
</body>
</html>
